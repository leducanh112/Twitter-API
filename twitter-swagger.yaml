openapi: 3.0.3
info:
  title: Twitter Clone API
  description: RESTful API for Twitter Clone application with user authentication, tweets, bookmarks, likes, and real-time chat
  version: 1.0.0
  contact:
    name: API Support
    email: support@twitter-clone.com

servers:
  - url: https://twitter-api-s1t1.onrender.com
    description: Development server

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    User:
      type: object
      properties:
        _id:
          type: string
        name:
          type: string
        email:
          type: string
        username:
          type: string
        date_of_birth:
          type: string
          format: date-time
        bio:
          type: string
        location:
          type: string
        website:
          type: string
        avatar:
          type: string
        cover_photo:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    Tweet:
      type: object
      properties:
        _id:
          type: string
        user_id:
          type: string
        type:
          type: integer
          enum: [0, 1, 2, 3]
          description: 0-Tweet, 1-Retweet, 2-Comment, 3-QuoteTweet
        audience:
          type: integer
          enum: [0, 1]
          description: 0-Everyone, 1-TwitterCircle
        content:
          type: string
        parent_id:
          type: string
          nullable: true
        hashtags:
          type: array
          items:
            type: string
        mentions:
          type: array
          items:
            type: string
        medias:
          type: array
          items:
            type: object
        guest_views:
          type: integer
        user_views:
          type: integer
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    Conversation:
      type: object
      properties:
        _id:
          type: string
        sender_id:
          type: string
        receiver_id:
          type: string
        content:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    ErrorResponse:
      type: object
      properties:
        message:
          type: string
        errors:
          type: object

    SuccessResponse:
      type: object
      properties:
        message:
          type: string

paths:
  /users/register:
    post:
      tags:
        - Users
      summary: Register a new user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - email
                - password
                - confirm_password
                - date_of_birth
              properties:
                name:
                  type: string
                email:
                  type: string
                  format: email
                password:
                  type: string
                  minLength: 6
                confirm_password:
                  type: string
                date_of_birth:
                  type: string
                  format: date-time
      responses:
        '201':
          description: User registered successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  result:
                    type: object
                    properties:
                      access_token:
                        type: string
                      refresh_token:
                        type: string
        '422':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /users/login:
    post:
      tags:
        - Users
      summary: Login user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  result:
                    type: object
                    properties:
                      access_token:
                        type: string
                      refresh_token:
                        type: string
        '422':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /users/oauth/google:
    get:
      tags:
        - Users
      summary: OAuth login with Google
      parameters:
        - in: query
          name: code
          schema:
            type: string
          required: true
          description: Google OAuth authorization code
      responses:
        '200':
          description: OAuth login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  result:
                    type: object
                    properties:
                      access_token:
                        type: string
                      refresh_token:
                        type: string

  /users/logout:
    post:
      tags:
        - Users
      summary: Logout user
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - refresh_token
              properties:
                refresh_token:
                  type: string
      responses:
        '200':
          description: Logout successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /users/refresh-token:
    post:
      tags:
        - Users
      summary: Refresh access token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - refresh_token
              properties:
                refresh_token:
                  type: string
      responses:
        '200':
          description: Token refreshed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  result:
                    type: object
                    properties:
                      access_token:
                        type: string
                      refresh_token:
                        type: string

  /users/verify-email:
    post:
      tags:
        - Users
      summary: Verify user email
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email_verify_token
              properties:
                email_verify_token:
                  type: string
      responses:
        '200':
          description: Email verified successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  result:
                    type: object
                    properties:
                      access_token:
                        type: string
                      refresh_token:
                        type: string

  /users/resend-verify-email:
    post:
      tags:
        - Users
      summary: Resend verification email
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Verification email sent successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /users/forgot-password:
    post:
      tags:
        - Users
      summary: Request password reset
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
      responses:
        '200':
          description: Password reset email sent
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /users/verify-forgot-password:
    post:
      tags:
        - Users
      summary: Verify forgot password token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - forgot_password_token
              properties:
                forgot_password_token:
                  type: string
      responses:
        '200':
          description: Token is valid
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /users/reset-password:
    post:
      tags:
        - Users
      summary: Reset password
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - forgot_password_token
                - password
                - confirm_password
              properties:
                forgot_password_token:
                  type: string
                password:
                  type: string
                  minLength: 6
                confirm_password:
                  type: string
      responses:
        '200':
          description: Password reset successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /users/change-password:
    put:
      tags:
        - Users
      summary: Change password
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - old_password
                - password
                - confirm_password
              properties:
                old_password:
                  type: string
                password:
                  type: string
                  minLength: 6
                confirm_password:
                  type: string
      responses:
        '200':
          description: Password changed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /users/me:
    get:
      tags:
        - Users
      summary: Get current user profile
      security:
        - BearerAuth: []
      responses:
        '200':
          description: User profile retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  result:
                    $ref: '#/components/schemas/User'

    patch:
      tags:
        - Users
      summary: Update current user profile
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                date_of_birth:
                  type: string
                  format: date-time
                bio:
                  type: string
                location:
                  type: string
                website:
                  type: string
                username:
                  type: string
                avatar:
                  type: string
                cover_photo:
                  type: string
      responses:
        '200':
          description: Profile updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  result:
                    $ref: '#/components/schemas/User'

  /users/{username}:
    get:
      tags:
        - Users
      summary: Get user profile by username
      parameters:
        - in: path
          name: username
          required: true
          schema:
            type: string
      responses:
        '200':
          description: User profile retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  result:
                    $ref: '#/components/schemas/User'

  /users/follow:
    post:
      tags:
        - Users
      summary: Follow a user
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - followed_user_id
              properties:
                followed_user_id:
                  type: string
      responses:
        '200':
          description: User followed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /users/follow/{user_id}:
    delete:
      tags:
        - Users
      summary: Unfollow a user
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: user_id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: User unfollowed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /tweets:
    post:
      tags:
        - Tweets
      summary: Create a new tweet
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - type
                - audience
                - content
              properties:
                type:
                  type: integer
                  enum: [0, 1, 2, 3]
                  description: 0-Tweet, 1-Retweet, 2-Comment, 3-QuoteTweet
                audience:
                  type: integer
                  enum: [0, 1]
                  description: 0-Everyone, 1-TwitterCircle
                content:
                  type: string
                parent_id:
                  type: string
                  nullable: true
                hashtags:
                  type: array
                  items:
                    type: string
                mentions:
                  type: array
                  items:
                    type: string
                medias:
                  type: array
                  items:
                    type: object
      responses:
        '201':
          description: Tweet created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  result:
                    $ref: '#/components/schemas/Tweet'

    get:
      tags:
        - Tweets
      summary: Get news feeds
      security:
        - BearerAuth: []
      parameters:
        - in: query
          name: limit
          schema:
            type: integer
            default: 10
        - in: query
          name: page
          schema:
            type: integer
            default: 1
      responses:
        '200':
          description: News feeds retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  result:
                    type: object
                    properties:
                      tweets:
                        type: array
                        items:
                          $ref: '#/components/schemas/Tweet'
                      limit:
                        type: integer
                      page:
                        type: integer
                      total_page:
                        type: integer

  /tweets/{tweet_id}:
    get:
      tags:
        - Tweets
      summary: Get tweet by ID
      parameters:
        - in: path
          name: tweet_id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Tweet retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  result:
                    $ref: '#/components/schemas/Tweet'

  /tweets/{tweet_id}/children:
    get:
      tags:
        - Tweets
      summary: Get tweet children (comments, quotes)
      parameters:
        - in: path
          name: tweet_id
          required: true
          schema:
            type: string
        - in: query
          name: limit
          schema:
            type: integer
            default: 10
        - in: query
          name: page
          schema:
            type: integer
            default: 1
        - in: query
          name: tweet_type
          schema:
            type: integer
            enum: [2, 3]
            description: 2-Comment, 3-QuoteTweet
      responses:
        '200':
          description: Tweet children retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  result:
                    type: object
                    properties:
                      tweets:
                        type: array
                        items:
                          $ref: '#/components/schemas/Tweet'
                      limit:
                        type: integer
                      page:
                        type: integer
                      total_page:
                        type: integer
                      tweet_type:
                        type: integer

  /bookmarks:
    post:
      tags:
        - Bookmarks
      summary: Bookmark a tweet
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - tweet_id
              properties:
                tweet_id:
                  type: string
      responses:
        '200':
          description: Tweet bookmarked successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /bookmarks/tweets/{tweet_id}:
    delete:
      tags:
        - Bookmarks
      summary: Remove bookmark from a tweet
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: tweet_id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Bookmark removed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /likes:
    post:
      tags:
        - Likes
      summary: Like a tweet
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - tweet_id
              properties:
                tweet_id:
                  type: string
      responses:
        '200':
          description: Tweet liked successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /likes/tweets/{tweet_id}:
    delete:
      tags:
        - Likes
      summary: Unlike a tweet
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: tweet_id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Tweet unliked successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /search:
    get:
      tags:
        - Search
      summary: Search for content
      parameters:
        - in: query
          name: content
          schema:
            type: string
          required: true
          description: Search query
        - in: query
          name: limit
          schema:
            type: integer
            default: 10
        - in: query
          name: page
          schema:
            type: integer
            default: 1
        - in: query
          name: media_type
          schema:
            type: string
            enum: [image, video]
        - in: query
          name: people_follow
          schema:
            type: string
            enum: ['0', '1']
            description: 0-All, 1-Following only
      responses:
        '200':
          description: Search results retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  result:
                    type: object
                    properties:
                      tweets:
                        type: array
                        items:
                          $ref: '#/components/schemas/Tweet'
                      limit:
                        type: integer
                      page:
                        type: integer
                      total_page:
                        type: integer

  /conversations/receivers/{receiver_id}:
    get:
      tags:
        - Conversations
      summary: Get conversation history with a user
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: receiver_id
          required: true
          schema:
            type: string
          description: The ID of the user to get conversations with
        - in: query
          name: limit
          schema:
            type: integer
            default: 20
          description: Number of messages to retrieve
        - in: query
          name: page
          schema:
            type: integer
            default: 1
          description: Page number for pagination
      responses:
        '200':
          description: Conversations retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Conversations fetched successfully
                  conversations:
                    type: array
                    items:
                      $ref: '#/components/schemas/Conversation'
                  limit:
                    type: integer
                  page:
                    type: integer
                  totalPage:
                    type: integer
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /media/upload-image:
    post:
      tags:
        - Media
      summary: Upload image
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                image:
                  type: string
                  format: binary
      responses:
        '200':
          description: Image uploaded successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  result:
                    type: object
                    properties:
                      url:
                        type: string
                      type:
                        type: integer

  /media/upload-video:
    post:
      tags:
        - Media
      summary: Upload video
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                video:
                  type: string
                  format: binary
      responses:
        '200':
          description: Video uploaded successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  result:
                    type: object
                    properties:
                      url:
                        type: string
                      type:
                        type: integer

  /media/upload-video-hls:
    post:
      tags:
        - Media
      summary: Upload video with HLS encoding
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                video:
                  type: string
                  format: binary
      responses:
        '200':
          description: Video uploaded and encoded successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  result:
                    type: object
                    properties:
                      url:
                        type: string
                      type:
                        type: integer

tags:
  - name: Users
    description: User authentication and profile management
  - name: Tweets
    description: Tweet creation and management
  - name: Bookmarks
    description: Bookmark management
  - name: Likes
    description: Like management
  - name: Search
    description: Search functionality
  - name: Conversations
    description: Direct messaging between users
  - name: Media
    description: Media upload and management
